#include <stdio.h>
#include <string.h>

#define FLAG '~'   // Frame delimiter
#define ESC  '\\'  // Escape character

// Function to perform byte stuffing
void byte_stuff(char input[], char stuffed[]) {
    int i, j = 0;

    stuffed[j++] = FLAG; // Start flag

    for (i = 0; i < strlen(input); i++) {
        // If FLAG or ESC appears in data, insert ESC before it
        if (input[i] == FLAG || input[i] == ESC) {
            stuffed[j++] = ESC;
        }
        stuffed[j++] = input[i];
    }

    stuffed[j++] = FLAG; // End flag
    stuffed[j] = '\0';
}

// Function to perform byte destuffing
void byte_destuff(char stuffed[], char destuffed[]) {
    int i, j = 0;

    // Skip starting FLAG and ending FLAG
    for (i = 1; i < strlen(stuffed) - 1; i++) {
        if (stuffed[i] == ESC) {
            // Skip ESC and take the next character
            i++;
        }
        destuffed[j++] = stuffed[i];
    }
    destuffed[j] = '\0';
}

int main() {
    char input[100], stuffed[200], destuffed[100];

    printf("Enter data to send: ");
    scanf("%s", input);

    // Byte stuffing
    byte_stuff(input, stuffed);
    printf("\nData after byte stuffing: %s\n", stuffed);

    // Byte destuffing
    byte_destuff(stuffed, destuffed);
    printf("Data after byte destuffing: %s\n", destuffed);

    return 0;
}